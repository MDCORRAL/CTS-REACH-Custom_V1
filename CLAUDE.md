# CLAUDE.md - AI Assistant Guide for CTS-REACH-Custom_V1

> **Purpose**: This document provides AI assistants with comprehensive context about the CTS-REACH-Custom_V1 repository, including codebase structure, development workflows, naming conventions, and key patterns to follow when making modifications.

**Last Updated**: 2025-11-25 (Updated with current file sizes and structure)
**Project Type**: Educational Data Visualization Dashboard
**Deployment**: GitHub Pages (Automatic via GitHub Actions)

---

## Table of Contents

1. [Project Overview](#project-overview)
2. [Repository Structure](#repository-structure)
3. [Technology Stack](#technology-stack)
4. [Naming Conventions](#naming-conventions)
5. [Code Patterns & Architecture](#code-patterns--architecture)
6. [Data Flow](#data-flow)
7. [Development Workflow](#development-workflow)
8. [Common Tasks](#common-tasks)
9. [Styling & Brand Guidelines](#styling--brand-guidelines)
10. [Testing & Deployment](#testing--deployment)
11. [Key Conventions for AI Assistants](#key-conventions-for-ai-assistants)

---

## Project Overview

### What This Project Does

This repository contains an **interactive single-page web application** that visualizes suspension data from **Dorothy Camp Kirby School**, a Juvenile Court School operated by the Los Angeles County Office of Education. The dashboard helps school administrators and researchers explore patterns and disparities across different student populations from the 2017-18 through 2023-24 academic years.

### Key Features

- **Interactive Filtering**: Filter by academic year and student group
- **Key Metrics Display**: Total enrollment, suspensions, suspension rates
- **5 Chart Types**: Trend lines, bar charts, doughnut charts showing various data dimensions
- **Detailed Data Table**: Complete data view with highlighting
- **Responsive Design**: Works on desktop, tablet, and mobile
- **Privacy-Aware**: Suppresses small counts to protect student privacy

### Project Context

**Important**: This is a Juvenile Court School serving students in the Los Angeles County juvenile justice system. The population faces significant challenges and trauma. Data should be interpreted within the context of therapeutic and rehabilitative goals.

---

## Repository Structure

```
/home/user/CTS-REACH-Custom_V1/
├── .github/
│   └── workflows/
│       └── static.yml              # GitHub Pages deployment (auto-triggers on push to main)
├── .git/                           # Git repository data
├── index.html                      # Main dashboard application (1566 lines)
│                                   # Contains: HTML + CSS + JavaScript in single file
├── clean_dorothy_camp_data.py      # Data cleaning script (100 lines)
├── dorothy_camp_clean_data.json    # Cleaned data (66 KB, 1996 lines, 105 records)
├── ev2_DorothyCamp_DataSummary.csv # Raw data - main dataset (54 rows)
├── ev2_DorothyCamp_DataSummary-RACE.csv  # Extended data with race categories (51 rows)
├── DOROTHY_CAMP_README.md          # User-facing documentation (comprehensive)
├── UCLA-Brand-Colors.md            # Brand color specifications
├── CLAUDE.md                       # AI assistant documentation (this file)
└── README.md                       # Placeholder (minimal content)
```

### File Purposes

| File | Purpose | When to Edit |
|------|---------|--------------|
| **index.html** | Main application (HTML/CSS/JS monolith) | Adding features, fixing bugs, changing UI |
| **clean_dorothy_camp_data.py** | ETL script (CSV → JSON) | Changing data processing logic |
| **dorothy_camp_clean_data.json** | Cleaned data source | Never edit directly (regenerated by Python script) |
| **ev2_DorothyCamp_DataSummary.csv** | Raw data from CA Dept of Education | When new data is received |
| **DOROTHY_CAMP_README.md** | User documentation | When features change |
| **UCLA-Brand-Colors.md** | Design system reference | Never (UCLA brand guidelines) |
| **.github/workflows/static.yml** | Deployment automation | Rarely (only if deployment needs change) |

---

## Technology Stack

### Frontend (No Build Process)

| Technology | Version | Purpose |
|------------|---------|---------|
| **HTML5** | Standard | Semantic page structure |
| **CSS3** | Standard | Styling, responsive grid layout, animations |
| **JavaScript** | ES6 | Data processing, chart creation, interactivity |
| **Chart.js** | 4.4.0 | Data visualization library (CDN) |
| **chartjs-plugin-datalabels** | 2.2.0 | Chart data labels plugin (CDN) |

**CDN Dependencies**:
```html
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.2.0/dist/chartjs-plugin-datalabels.min.js"></script>
```

### Backend/Processing

| Technology | Version | Purpose |
|------------|---------|---------|
| **Python** | 3.x | Data cleaning and ETL |
| **Standard Library Only** | - | csv, json, sys modules |

**No package.json, no npm, no pip requirements** - This is a simple static site.

### Deployment

- **GitHub Pages**: Static file hosting
- **GitHub Actions**: Automatic deployment on push to `main` branch

---

## Naming Conventions

### Critical: Follow These Conventions Strictly

#### JavaScript (in index.html)

```javascript
// Variables: camelCase
let allData = [];
let charts = {};
const yearFilter = 'all';
const filteredData = getFilteredData();

// Functions: camelCase
function loadData() { }
function initializeDashboard() { }
function createTrendChart(data) { }
function updateMetrics(data) { }

// DOM Element IDs: camelCase
document.getElementById('yearFilter');
document.getElementById('metricsGrid');
document.getElementById('trendChart');
```

**Pattern Suffixes**:
- `...Filter` for select elements
- `...Chart` for canvas elements
- `...Grid` for container divs
- `...Body` for table body elements

#### CSS (in index.html)

```css
/* Classes: kebab-case */
.metric-card { }
.charts-grid { }
.filter-group { }
.alert-info { }
.highlight-total { }
```

#### Python (clean_dorothy_camp_data.py)

```python
# Functions: snake_case
def clean_value(value):
def clean_reporting_category(description):
def main():

# Variables: snake_case
input_file = 'ev2_DorothyCamp_DataSummary.csv'
cleaned_data = []
```

#### JSON Field Names

**CSV Column** → **JSON Field** (camelCase conversion):

```json
{
  "CumulativeEnrollment" → "cumulativeEnrollment",
  "Total Suspensions" → "totalSuspensions",
  "Unduplicated Count of Students Suspended (Total)" → "uniqueStudentsSuspended",
  "Suspension Rate (Total)" → "suspensionRate",
  "ReportingCategory_Description" → "reportingCategoryDescription"
}
```

#### File Names

- **Python/CSV/JSON/Markdown**: `snake_case.ext`
  - `clean_dorothy_camp_data.py`
  - `dorothy_camp_clean_data.json`
- **HTML**: `kebab-case.html` or `lowercase.html`
  - `index.html`
- **Config**: `kebab-case.yml`
  - `static.yml`

---

## Code Patterns & Architecture

### Single-Page Application (SPA) Architecture

The entire application is contained in **one HTML file** (`index.html`) with three main sections:

1. **HTML Head & Metadata** (lines 1-8): Meta tags, title, CDN script imports
2. **CSS Styling** (lines 9-230): Embedded in `<style>` tag
3. **HTML Body Structure** (lines 232-387): Semantic markup
4. **JavaScript Logic** (lines 388-1564): Embedded in `<script>` tag

### Global State Management

```javascript
// Global state (top of script section)
let allData = [];  // Immutable source of truth loaded from JSON
let charts = {};   // Chart.js instances (prevents memory leaks)
```

**Critical**: `allData` is loaded once and never modified. All operations use filtering/mapping.

### Application Initialization Flow

```javascript
// 1. Page loads
window.onload → loadData()

// 2. Data loads asynchronously
async function loadData() {
    const response = await fetch('dorothy_camp_clean_data.json');
    allData = await response.json();
    initializeDashboard();
}

// 3. Dashboard initializes
function initializeDashboard() {
    populateFilters();          // Populate year/group dropdowns
    const filteredData = getFilteredData();
    updateMetrics(filteredData); // Show key metrics
    createCharts(filteredData);  // Render all charts
    updateTable(filteredData);   // Populate data table
    updateGroupList(filteredData); // Update group display
}

// 4. User interactions trigger updates
yearFilter.addEventListener('change', updateDashboard);
groupFilter.addEventListener('change', updateDashboard);
```

### Data Processing Patterns

#### Filtering Pattern

```javascript
function getFilteredData() {
    const yearFilter = document.getElementById('yearFilter').value;
    const groupFilter = document.getElementById('groupFilter').value;

    return allData.filter(d => {
        const yearMatch = yearFilter === 'all' || d.academicYear === yearFilter;
        const groupMatch = groupFilter === 'all' || d.reportingCategoryDescription === groupFilter;
        return yearMatch && groupMatch;
    });
}
```

#### Aggregation Pattern

```javascript
// Reduce for totals
const totalEnrollment = data.reduce((sum, d) => sum + (d.cumulativeEnrollment || 0), 0);

// Map for transformation
const rates = years.map(year => {
    const yearRecords = data.filter(d => d.academicYear === year);
    return yearRecords[0]?.suspensionRate * 100 || null;
});
```

#### Deduplication Pattern

```javascript
// Get unique values using Set
const years = [...new Set(allData.map(d => d.academicYear))].sort();
const groups = [...new Set(allData.map(d => d.reportingCategoryDescription))].sort();
```

### Chart Creation Pattern

```javascript
function createTrendChart(data) {
    const ctx = document.getElementById('trendChart').getContext('2d');

    // CRITICAL: Destroy previous chart to prevent memory leaks
    if (charts.trend) {
        charts.trend.destroy();
    }

    // Create new chart
    charts.trend = new Chart(ctx, {
        type: 'line',
        data: { /* data config */ },
        options: {
            /* chart options */
            plugins: {
                datalabels: getPercentDatalabelsConfig() // Use for percent charts
            }
        }
    });
}
```

**Always destroy old charts before creating new ones!**

### Percent Label Formatting Pattern

**CRITICAL**: All percentage-based charts must use the standardized formatting helper:

```javascript
// Shared configuration defined at line 428
function getPercentDatalabelsConfig(overrides = {}) {
    return {
        align: 'top',
        anchor: 'end',
        backgroundColor: 'rgba(255, 255, 255, 0.9)',
        borderRadius: 4,
        padding: 4,
        font: {
            weight: 'bold',
            size: 11
        },
        formatter: function(value, context) {
            if (value === null || value === undefined || isNaN(value)) {
                return 'N/A';
            }
            return value.toFixed(1) + '%';
        },
        ...overrides  // Allow chart-specific overrides
    };
}

// Usage in chart creation
const chart = new Chart(ctx, {
    type: 'bar',
    data: { /* ... */ },
    options: {
        plugins: {
            datalabels: getPercentDatalabelsConfig() // Use this for all percent charts
        }
    }
});
```

**This ensures consistent formatting across all charts**:
- Format: `12.3%` (one decimal place)
- Displays `N/A` for null/undefined values
- Consistent styling (white background, bold font, padding)
- Alignment: top/end by default (can be overridden)

### Error Handling Pattern

```javascript
async function loadData() {
    try {
        const response = await fetch('dorothy_camp_clean_data.json');
        allData = await response.json();
        initializeDashboard();
    } catch (error) {
        console.error('Error loading data:', error);
        alert('Error loading data. Please ensure dorothy_camp_clean_data.json is in the same directory.');
    }
}
```

### Python ETL Pattern

**Important**: The script now processes **two CSV files** and combines them:

```python
def load_csv_rows(path):
    """Load CSV with latin-1 encoding (handles non-UTF8 characters)"""
    with open(path, 'r', encoding='latin-1') as f:
        reader = csv.DictReader(f)
        return list(reader)

def main():
    # 1. Define input files
    input_files = [
        Path('ev2_DorothyCamp_DataSummary.csv'),      # 54 rows - general data
        Path('ev2_DorothyCamp_DataSummary-RACE.csv')  # 51 rows - race breakdown
    ]
    output_file = 'dorothy_camp_clean_data.json'
    cleaned_data = []

    # 2. Process each CSV file
    for path in input_files:
        if not path.exists():
            # Handle missing files gracefully
            continue

        for row in load_csv_rows(path):
            # 3. Handle column name differences between files
            suspension_rate_key = 'Suspension Rate [%] (Total)' if 'Suspension Rate [%] (Total)' in row else 'Suspension Rate (Total)'

            # 4. Transform each row
            cleaned_row = {
                'academicYear': row['AcademicYear'],
                'cumulativeEnrollment': clean_value(row['CumulativeEnrollment']),
                'suspensionRate': clean_value(row[suspension_rate_key]),
                # ... more fields
                'schoolType': row['School Type'],
                'sourceFile': path.name  # Track which CSV this came from
            }
            cleaned_data.append(cleaned_row)

    # 5. Write combined JSON with UTF-8 encoding
    with open(output_file, 'w', encoding='utf-8') as f:
        json.dump(cleaned_data, f, indent=2)

    # 6. Print summary
    print(f"✓ Cleaned {len(cleaned_data)} records")
```

**Key features**:
- Processes multiple CSV files in a loop
- Handles missing files gracefully
- Adapts to different column names between files
- Tags each record with `sourceFile` for traceability
- Combines all data into single JSON output

---

## Data Flow

```
┌─────────────────────────────────────┐
│ California Dept of Education        │
│ (Source: CDE Data Portal)           │
└───────────┬─────────────────────────┘
            │
            ▼
┌─────────────────────────────────────┬─────────────────────────────────────┐
│ ev2_DorothyCamp_DataSummary.csv     │ ev2_DorothyCamp_DataSummary-RACE.csv│
│ - Raw CSV with 30+ columns          │ - Extended CSV with race categories │
│ - Encoding: latin-1                 │ - Encoding: latin-1                 │
│ - 54 rows (general data)            │ - 51 rows (race breakdown)          │
│ - Missing values: "*" asterisks     │ - Missing values: "*" asterisks     │
└───────────┬─────────────────────────┴─────────────────────────────────────┘
            │
            ▼ (Run: python3 clean_dorothy_camp_data.py)
┌─────────────────────────────────────┐
│ clean_dorothy_camp_data.py          │
│ - load_csv_rows(): reads both files │
│ - clean_value(): type conversion    │
│ - clean_reporting_category(): fixes │
│ - Converts 2 CSVs → 1 JSON (105 rec)│
└───────────┬─────────────────────────┘
            │
            ▼
┌─────────────────────────────────────┐
│ dorothy_camp_clean_data.json        │
│ - Encoding: UTF-8                   │
│ - Field names: camelCase            │
│ - Types: null, int, float, string   │
│ - 105 records (54 + 51)             │
│ - 66 KB, 1996 lines                 │
└───────────┬─────────────────────────┘
            │
            ▼ (Browser: fetch API)
┌─────────────────────────────────────┐
│ index.html (JavaScript)             │
│ - Loads JSON asynchronously         │
│ - Stores in allData global (105 rec)│
└───────────┬─────────────────────────┘
            │
            ▼
┌─────────────────────────────────────┐
│ Data Processing Layer               │
│ - Filter by year/group/race         │
│ - Aggregate metrics                 │
│ - Transform for charts              │
│ - Apply percent formatting          │
└───────────┬─────────────────────────┘
            │
            ▼
┌─────────────────────────────────────┐
│ Chart.js + chartjs-plugin-datalabels│
│ - Renders visualizations            │
│ - Standardized percent labels       │
│ - Handles interactions              │
└───────────┬─────────────────────────┘
            │
            ▼
┌─────────────────────────────────────┐
│ Browser Display                     │
│ - Metrics cards                     │
│ - Multiple interactive charts       │
│ - Filterable data table             │
│ - CSV export functionality          │
└─────────────────────────────────────┘
```

---

## Development Workflow

### Standard Workflow for Common Changes

#### 1. Data Update Workflow

When new suspension data is received:

```bash
# 1. Save new CSV file (overwrites old one)
#    File: ev2_DorothyCamp_DataSummary.csv

# 2. Run Python cleaning script
python3 clean_dorothy_camp_data.py

# Output:
# ✓ Cleaned 52 records
# ✓ Output written to dorothy_camp_clean_data.json
#
# Data Summary:
#   Academic Years: ['2017-18', '2018-19', '2019-20', ...]
#   Student Groups: 8
#   Categories: ['English Learners', 'Female', 'Male', ...]

# 3. Test locally
# Open index.html in browser, verify data displays correctly

# 4. Commit and push
git add ev2_DorothyCamp_DataSummary.csv dorothy_camp_clean_data.json
git commit -m "Update suspension data for 2024-25 academic year"
git push origin main

# 5. GitHub Actions automatically deploys to GitHub Pages
```

#### 2. Dashboard Feature Development

```bash
# 1. Edit index.html
#    - Modify HTML structure (lines 1-321)
#    - Update CSS styling (lines 8-222)
#    - Add/modify JavaScript (lines 323-763)

# 2. Test locally
#    - Open index.html in browser (or use `python -m http.server 8000`)
#    - Verify functionality works
#    - Test responsive design (mobile/tablet/desktop)

# 3. Update documentation if needed
#    - Edit DOROTHY_CAMP_README.md for user-facing changes
#    - Edit CLAUDE.md for developer/AI assistant changes

# 4. Commit and push
git add index.html DOROTHY_CAMP_README.md
git commit -m "Add new chart showing [feature description]"
git push origin main
```

#### 3. Python Script Modifications

```bash
# 1. Edit clean_dorothy_camp_data.py

# 2. Test with current data
python3 clean_dorothy_camp_data.py

# 3. Verify JSON output is correct
cat dorothy_camp_clean_data.json | python -m json.tool

# 4. Test dashboard still works
# Open index.html in browser

# 5. Commit
git add clean_dorothy_camp_data.py
git commit -m "Fix encoding issue in data cleaning script"
git push origin main
```

### Local Development Setup

**No complex setup required!**

1. **Clone repository**:
   ```bash
   git clone <repo-url>
   cd CTS-REACH-Custom_V1
   ```

2. **Open in browser**:
   - Option A: Double-click `index.html`
   - Option B: `python -m http.server 8000` then visit `http://localhost:8000`

3. **Make changes and refresh browser**

**Requirements**:
- Modern web browser (Chrome, Firefox, Safari, Edge)
- Python 3.x (only if processing data)
- Text editor

**No npm install, no build process, no Docker, no database!**

---

## Common Tasks

### Adding a New Chart

1. **Add canvas element in HTML** (around line 300-350):
   ```html
   <div class="chart-container">
       <h3>Your New Chart Title</h3>
       <canvas id="yourNewChart"></canvas>
   </div>
   ```

2. **Create chart function in JavaScript** (around line 850-1350):
   ```javascript
   function createYourNewChart(data) {
       const ctx = document.getElementById('yourNewChart').getContext('2d');

       if (charts.yourNew) {
           charts.yourNew.destroy();
       }

       charts.yourNew = new Chart(ctx, {
           type: 'bar', // or 'line', 'doughnut', etc.
           data: {
               labels: [...],
               datasets: [{
                   label: 'Your Dataset',
                   data: [...],
                   backgroundColor: '#2C5F8D'
               }]
           },
           options: {
               responsive: true,
               maintainAspectRatio: false
           }
       });
   }
   ```

3. **Call in chart initialization section** (around line 640-660):
   ```javascript
   function initializeDashboard() {
       populateFilters();
       updateMetrics(getFilteredDataForMetrics());
       createTrendChart(getFilteredDataForTrend());
       // ... other chart creation calls
       createYourNewChart(data); // Add here
       updateTable();
   }
   ```

### Adding a New Filter

1. **Add select element in HTML** (around line 260-280):
   ```html
   <div class="filter-group">
       <label for="yourNewFilter">Your Filter:</label>
       <select id="yourNewFilter">
           <option value="all">All</option>
           <!-- Options populated by JavaScript -->
       </select>
   </div>
   ```

2. **Populate filter in `populateFilters()`** (around line 650):
   ```javascript
   const yourOptions = [...new Set(allData.map(d => d.yourField))].sort();
   const yourFilter = document.getElementById('yourNewFilter');

   yourOptions.forEach(option => {
       const optionElement = document.createElement('option');
       optionElement.value = option;
       optionElement.textContent = option;
       yourFilter.appendChild(optionElement);
   });

   yourFilter.addEventListener('change', updateDashboard);
   ```

3. **Update `getFilteredDataForMetrics()` and/or `getFilteredDataForTrend()`** (around line 772-792):
   ```javascript
   const yourFilter = document.getElementById('yourNewFilter').value;

   return allData.filter(d => {
       const yourMatch = yourFilter === 'all' || d.yourField === yourFilter;
       return yearMatch && groupMatch && yourMatch;
   });
   ```

### Adding a New Data Field

1. **Modify Python script** (clean_dorothy_camp_data.py):
   ```python
   cleaned_row = {
       # ... existing fields ...
       'yourNewField': clean_value(row['Your CSV Column Name']),
   }
   ```

2. **Regenerate JSON**:
   ```bash
   python3 clean_dorothy_camp_data.py
   ```

3. **Use in JavaScript** (index.html):
   ```javascript
   const value = record.yourNewField; // camelCase
   ```

### Changing Colors/Styling

**Primary color palette** (defined in CSS around lines 15-100):
```css
:root {
    --primary-blue: #2C5F8D;
    --secondary-blue: #4A90C2;
    --accent-orange: #FF8A65;
    --accent-yellow: #FFB74D;
    --background: #f5f5f5;
}
```

**Chart colors** (in Chart.js config around lines 850-1350):
```javascript
backgroundColor: '#2C5F8D',  // Change this
borderColor: '#4A90C2',      // And this
```

**Reference UCLA brand colors** in `UCLA-Brand-Colors.md` for official colors.

---

## Styling & Brand Guidelines

### Color System

**Dashboard Palette** (current usage):
- **Primary Blue**: `#2C5F8D` (headers, primary elements)
- **Secondary Blue**: `#4A90C2` (accents, hover states)
- **Accent Orange**: `#FF8A65` (data visualization)
- **Accent Yellow**: `#FFB74D` (data visualization)
- **Background**: `#f5f5f5` (page background)
- **White**: `#ffffff` (cards, containers)

**UCLA Brand Colors** (reference in `UCLA-Brand-Colors.md`):
- **UCLA Blue**: `#2774AE` (RGB: 39, 116, 174)
- **Darkest Blue**: `#003B5C` (RGB: 0, 59, 92)
- **UCLA Gold**: `#FFD100` (RGB: 255, 209, 0)

### Accessibility Requirements

From UCLA Brand Guidelines:
- **WCAG Level AA**: Contrast ratio ≥ 4.5:1 for normal text
- **WCAG Level AAA**: Contrast ratio ≥ 7:1 for normal text
- **Large text** = 14pt bold (18.66px) or 18pt (24px) and larger

**Test contrast**: Use WebAIM Contrast Checker (https://webaim.org/resources/contrastchecker/)

### Responsive Design

**Breakpoints** (in CSS around lines 200-230):
```css
/* Mobile: Default styles */

/* Tablet and up: 768px */
@media (min-width: 768px) {
    .charts-grid {
        grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
    }
}

/* Desktop: Max container width */
.container {
    max-width: 1400px;
}
```

### Typography

```css
body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
}

.header h1 {
    font-size: 2rem;
}

.metric-value {
    font-size: 2.5rem;
    font-weight: bold;
}
```

---

## Testing & Deployment

### Testing Approach

**Manual Testing Only** (no automated tests):

1. **Visual Inspection**:
   - Open index.html in browser
   - Verify all charts render correctly
   - Check responsive design (resize browser window)

2. **Filter Testing**:
   - Test year filter (select each year)
   - Test group filter (select each group)
   - Test combination of filters

3. **Data Accuracy**:
   - Spot-check metrics against CSV data
   - Verify chart values match table values

4. **Cross-Browser Testing**:
   - Test in Chrome, Firefox, Safari, Edge
   - Test on mobile devices

### Deployment Process

**Automatic GitHub Pages Deployment**:

1. **Trigger**: Push to `main` branch
2. **GitHub Actions runs** `.github/workflows/static.yml`:
   ```yaml
   on:
     push:
       branches: ["main"]

   jobs:
     deploy:
       steps:
         - Checkout code
         - Setup GitHub Pages
         - Upload entire repository as artifact
         - Deploy to GitHub Pages
   ```
3. **Live in ~1-2 minutes** at: `https://[username].github.io/CTS-REACH-Custom_V1/`

**No manual deployment steps required!**

### Rollback Procedure

If deployment breaks:

```bash
# 1. Revert commit
git revert HEAD
git push origin main

# 2. GitHub Actions automatically redeploys previous version
```

---

## Key Conventions for AI Assistants

### Critical Rules When Modifying This Repository

#### 1. **Single-File Architecture**

- **All HTML, CSS, and JavaScript is in `index.html`**
- Do NOT create separate `.js` or `.css` files unless explicitly requested
- Keep the monolithic structure for simplicity

#### 2. **Never Modify JSON Directly**

- `dorothy_camp_clean_data.json` is **generated by Python script**
- Always edit `clean_dorothy_camp_data.py` and regenerate
- Exception: If user explicitly requests a one-time JSON fix

#### 3. **Chart Memory Management**

Always destroy old charts before creating new ones:

```javascript
// CORRECT:
if (charts.trend) {
    charts.trend.destroy();
}
charts.trend = new Chart(ctx, { ... });

// WRONG (causes memory leak):
charts.trend = new Chart(ctx, { ... });
```

#### 4. **Immutable Data Pattern**

- `allData` is loaded once and **never modified**
- All operations use `.filter()`, `.map()`, `.reduce()`
- Never use `.push()`, `.splice()`, or direct mutation on `allData`

#### 5. **Naming Consistency**

- **JavaScript**: `camelCase` for everything
- **CSS**: `kebab-case` for classes
- **Python**: `snake_case` for everything
- **JSON fields**: `camelCase` (converted from CSV)

#### 6. **Privacy-First Data Handling**

- Data with `*` in CSV represents privacy-suppressed values
- Convert to `null` in JSON (never `0` or empty string)
- Display as "N/A" in UI (never "0")
- Never attempt to recover or estimate suppressed values

#### 7. **Percent Label Consistency**

- All percentage data labels on charts must use the shared helpers in `index.html`: `percentLabelFormatter`, `getPercentDatalabelsConfig()`, and the shared `percentDatalabels` config instance.
- Format percentages as **one decimal place with a trailing percent sign** (e.g., `12.3%`) and show `N/A` for missing or invalid values. Reuse the `percentDatalabels` config for every percent-based chart so styling (background, padding, alignment, font weight) stays identical across charts.
- Keep alignment/anchor consistent (`align: 'top'`, `anchor: 'end'`) unless a chart explicitly requires a different override.

#### 8. **Responsive Design Required**

- All changes must work on mobile, tablet, and desktop
- Test at minimum: 320px, 768px, 1024px, 1440px widths
- Use CSS Grid with `auto-fit` and `minmax()`

#### 8. **Deployment Automation**

- **DO NOT** modify `.github/workflows/static.yml` without explicit request
- Pushing to `main` automatically deploys
- Test changes locally before pushing

#### 9. **Documentation Updates**

When making significant changes, update:
- `DOROTHY_CAMP_README.md` (user-facing documentation)
- `CLAUDE.md` (this file - for future AI assistants)

#### 10. **Encoding Awareness**

- **CSV input**: `encoding='latin-1'` (non-UTF8 characters exist)
- **JSON output**: `encoding='utf-8'`
- Python script handles this conversion

### When User Asks To...

| User Request | What To Do | What NOT To Do |
|--------------|------------|----------------|
| "Add a new chart" | Add canvas in HTML, create chart function, call in `createCharts()` | Don't create separate JS file |
| "Update data" | Save new CSV, run Python script, commit both CSV and JSON | Don't manually edit JSON |
| "Change colors" | Edit CSS in `<style>` section and Chart.js config | Don't create separate CSS file |
| "Fix bug in data processing" | Edit `clean_dorothy_camp_data.py`, regenerate JSON, test | Don't patch JSON manually |
| "Make it mobile-friendly" | Use CSS media queries, test responsive design | Don't create separate mobile version |
| "Deploy changes" | Commit and push to `main` branch | Don't modify GitHub Actions workflow |

### Error Handling

Always include:
```javascript
try {
    // Risky operation
} catch (error) {
    console.error('Descriptive error message:', error);
    alert('User-friendly error message');
}
```

### Code Comments

- **Keep comments minimal** - function names should be self-documenting
- **Do add comments** when:
  - Logic is non-obvious
  - Handling special cases (privacy suppression, encoding fixes)
  - Working around browser quirks

### Performance Considerations

- **Data is small** (~50 records) - optimize for readability, not performance
- **Chart destruction** prevents memory leaks (more important than render speed)
- **Filters are synchronous** - no need for debouncing with this data size

---

## Quick Reference

### File Line Number Guide

**index.html** (1566 lines):
- Lines 1-8: HTML head, meta tags, CDN imports
- Lines 9-230: CSS styling
- Lines 231: `</head>` closing tag
- Lines 232-387: HTML body structure
- Lines 388-1564: JavaScript application logic
- Lines 1565-1566: Closing tags

**Key JavaScript Functions** (exact lines):
- `getPercentDatalabelsConfig()`: Line 428 (shared percent label config)
- `loadData()`: Line 448
- `initializeDashboard()`: Line 628
- `populateFilters()`: Line 650
- `getFilteredDataForMetrics()`: Line 772
- `getFilteredDataForTrend()`: Line 781
- `updateMetrics()`: Line 792
- `createTrendChart()`: Line 853
- `updateTable()`: Line 1371

### Essential Commands

```bash
# Regenerate clean data
python3 clean_dorothy_camp_data.py

# Test locally
python -m http.server 8000
# Then visit: http://localhost:8000

# Deploy (automatic)
git add .
git commit -m "Your commit message"
git push origin main
```

### Key Data Fields

**JSON Structure** (each record - 105 total records):
```json
{
  "academicYear": "2023-24",
  "schoolName": "Dorothy Camp Kirby School",
  "reportingCategory": "TA",
  "reportingCategoryDescription": "Total",
  "cumulativeEnrollment": 245,
  "totalSuspensions": 89,
  "uniqueStudentsSuspended": 67,
  "uniqueStudentsSuspendedDefianceOnly": 32,
  "suspensionRate": 0.273,
  "suspensionsViolentWithInjury": 12,
  "suspensionsViolentNoInjury": 23,
  "suspensionsWeapons": 3,
  "suspensionsDrugs": 1,
  "suspensionsDefianceOnly": 34,
  "suspensionsOther": 16,
  "schoolType": "Juvenile Court School",
  "sourceFile": "ev2_DorothyCamp_DataSummary.csv"
}
```

**Note**: The JSON now combines data from both CSV files:
- 54 records from `ev2_DorothyCamp_DataSummary.csv`
- 51 records from `ev2_DorothyCamp_DataSummary-RACE.csv`
- Total: 105 records

---

## Additional Resources

- **Chart.js Documentation**: https://www.chartjs.org/docs/latest/
- **UCLA Brand Guidelines**: See `UCLA-Brand-Colors.md`
- **User Documentation**: See `DOROTHY_CAMP_README.md`
- **California Education Data**: https://www.cde.ca.gov/ds/

---

## Maintenance Notes

### When Data Structure Changes

If CDE changes their CSV format:
1. Update `clean_dorothy_camp_data.py` to handle new columns
2. Regenerate JSON
3. Update JavaScript to use new fields
4. Test all charts and metrics
5. Update this documentation

### When Adding New Student Groups

The dashboard automatically handles new groups:
- Filters auto-populate from data
- Charts include all groups in data
- No code changes needed (unless custom logic required)

### When Scaling Beyond Current Size

If data grows significantly (>1000 records):
- Consider adding pagination to table
- Implement filter debouncing
- Consider lazy loading of chart data
- May need to split into multiple files
- Consider moving to a database solution

Current architecture is optimized for **small-to-medium datasets** (100-500 records).
**Current size**: 105 records across 7 academic years with multiple demographic breakdowns.

---

## Version History

- **2025-11-25 (Latest Update)**: Updated CLAUDE.md with accurate file sizes, line numbers, and current structure
  - index.html expanded from 765 to 1566 lines
  - Added chartjs-plugin-datalabels dependency for consistent percent formatting
  - Data expanded from ~50 to 105 records (combining both CSV sources)
  - Added new data fields: `uniqueStudentsSuspendedDefianceOnly`, `schoolType`, `sourceFile`
  - Multiple PRs focusing on standardizing data labels across charts
  - Added CSV export functionality
  - New helper functions: `getPercentDatalabelsConfig()`, `getFilteredDataForMetrics()`, `getFilteredDataForTrend()`

- **2025-11-25 (Initial)**: Initial CLAUDE.md created with comprehensive documentation
- **2025-11**: Recent commits: Updated dashboard to include all race categories, show all student groups

---

## Contact & Support

For issues or questions:
- **Repository Issues**: https://github.com/MDCORRAL/CTS-REACH-Custom_V1/issues
- **Data Source**: California Department of Education
- **School**: Dorothy Camp Kirby School, Los Angeles County Office of Education

---

**End of CLAUDE.md**

*This document should be updated whenever significant architectural changes are made to the repository.*
